<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"
      />

  <title>Weather Radar</title>

  <%= csrf_meta_tags %>
  <%= csp_meta_tag %>

  <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
  <%= javascript_importmap_tags %>

</head>

<body>
<div data-controller="weather-map-web"
     data-weather-map-web-api-key="<%= ENV["MAP_TILER"] %>"
     data-weather-map-web-lat="<%= lat %>"
     data-weather-map-web-lng="<%= lng %>"
     data-weather-map-web-type="radar">

  <!-- Map -->
  <div id="map"></div>
  <!-- Header overlay -->
  <%= render 'header_radar', locals: { type_name: @type.titlecase } %>


  <!-- Controls overlay -->
  <%= render 'weather_controls' %>

  <script>
      (function () {
          const controls = document.querySelector('.map-overlay.controls');
          if (!controls) return;

          let hideTimer = null;
          const HIDE_DELAY = 3000;

          function showControls() {
              controls.classList.remove('hidden');
              resetTimer();
          }

          function hideControls() {
              controls.classList.add('hidden');
          }

          function resetTimer() {
              clearTimeout(hideTimer);
              hideTimer = setTimeout(hideControls, HIDE_DELAY);
          }

          // Show on first load, then auto-hide
          resetTimer();

          // Tap anywhere on map toggles controls
          document.getElementById('map')?.addEventListener('click', () => {
              if (controls.classList.contains('hidden')) {
                  showControls();
              } else {
                  hideControls();
              }
          });

          // Any interaction with controls keeps them visible
          controls.addEventListener('pointerdown', showControls);
      })();
  </script>


</div>
</body>
</html>
